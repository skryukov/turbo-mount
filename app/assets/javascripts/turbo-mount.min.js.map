{"version":3,"file":"turbo-mount.min.js","sources":["../src/turbo-mount-controller.ts","../src/turbo-mount.ts","../src/helpers.ts"],"sourcesContent":["import { Controller } from \"@hotwired/stimulus\";\nimport { ApplicationWithTurboMount } from \"./turbo-mount\";\n\nexport abstract class TurboMountController<T> extends Controller {\n  static values = {\n    props: Object,\n    component: String,\n  };\n  static targets = [\"mount\"];\n\n  declare readonly propsValue: object;\n  declare readonly componentValue: string;\n  declare readonly hasMountTarget: boolean;\n  declare readonly mountTarget: Element;\n\n  abstract framework: string;\n\n  abstract mountComponent(el: Element, Component: T, props: object): () => void;\n\n  _umountComponentCallback?: () => void;\n\n  connect() {\n    this._umountComponentCallback ||= this.mountComponent(\n      this.mountElement,\n      this.resolvedComponent,\n      this.componentProps,\n    );\n  }\n\n  disconnect() {\n    this.umountComponent();\n  }\n\n  propsValueChanged() {\n    this.umountComponent();\n    this._umountComponentCallback ||= this.mountComponent(\n      this.mountElement,\n      this.resolvedComponent,\n      this.componentProps,\n    );\n  }\n\n  get componentProps() {\n    return this.propsValue;\n  }\n\n  get mountElement() {\n    return this.hasMountTarget ? this.mountTarget : this.element;\n  }\n\n  get resolvedComponent() {\n    return this.resolveComponent(this.componentValue);\n  }\n\n  umountComponent() {\n    this._umountComponentCallback && this._umountComponentCallback();\n    this._umountComponentCallback = undefined;\n  }\n\n  resolveComponent(component: string): T {\n    const app = this.application as ApplicationWithTurboMount<T>;\n    return app.turboMount[this.framework].resolve(component);\n  }\n}\n","import { Application, ControllerConstructor } from \"@hotwired/stimulus\";\n\nimport { camelToKebabCase } from \"./helpers\";\n\nexport interface ApplicationWithTurboMount<T> extends Application {\n  turboMount: { [framework: string]: TurboMount<T> };\n}\n\nexport type Plugin = {\n  framework: string;\n  controller: ControllerConstructor;\n};\n\nexport class TurboMount<T> {\n  components: Map<string, T>;\n  application: ApplicationWithTurboMount<T>;\n  framework: string;\n  baseController?: ControllerConstructor;\n\n  constructor(props: { application: Application; plugin: Plugin }) {\n    this.components = new Map();\n    this.application = props.application as ApplicationWithTurboMount<T>;\n    this.framework = props.plugin.framework;\n    this.baseController = props.plugin.controller;\n\n    this.application.turboMount ||= {};\n    this.application.turboMount[this.framework] = this;\n\n    if (this.baseController) {\n      this.application.register(\n        `turbo-mount-${this.framework}`,\n        this.baseController,\n      );\n    }\n  }\n\n  register(name: string, component: T, controller?: ControllerConstructor) {\n    controller ||= this.baseController;\n    if (this.components.has(name)) {\n      throw new Error(`Component '${name}' is already registered.`);\n    }\n    this.components.set(name, component);\n\n    if (controller) {\n      const controllerName = `turbo-mount-${this.framework}-${camelToKebabCase(name)}`;\n      this.application.register(controllerName, controller);\n    }\n  }\n\n  resolve(name: string) {\n    const component = this.components.get(name);\n    if (!component) {\n      throw new Error(`Unknown component: ${name}`);\n    }\n    return component;\n  }\n}\n","export const camelToKebabCase = (str: string) => {\n  return str.replace(/([a-z])([A-Z])/g, \"$1-$2\").toLowerCase();\n};\n"],"names":["TurboMountController","Controller","connect","this","_umountComponentCallback","mountComponent","mountElement","resolvedComponent","componentProps","disconnect","umountComponent","propsValueChanged","propsValue","hasMountTarget","mountTarget","element","resolveComponent","componentValue","undefined","component","application","turboMount","framework","resolve","values","props","Object","String","targets","TurboMount","constructor","components","Map","plugin","baseController","controller","_a","register","name","has","Error","set","controllerName","str","replace","toLowerCase","get"],"mappings":"gDAGM,MAAgBA,UAAgCC,EAkBpD,OAAAC,GACEC,KAAKC,2BAALD,KAAKC,yBAA6BD,KAAKE,eACrCF,KAAKG,aACLH,KAAKI,kBACLJ,KAAKK,gBAER,CAED,UAAAC,GACEN,KAAKO,iBACN,CAED,iBAAAC,GACER,KAAKO,kBACLP,KAAKC,2BAALD,KAAKC,yBAA6BD,KAAKE,eACrCF,KAAKG,aACLH,KAAKI,kBACLJ,KAAKK,gBAER,CAED,kBAAIA,GACF,OAAOL,KAAKS,UACb,CAED,gBAAIN,GACF,OAAOH,KAAKU,eAAiBV,KAAKW,YAAcX,KAAKY,OACtD,CAED,qBAAIR,GACF,OAAOJ,KAAKa,iBAAiBb,KAAKc,eACnC,CAED,eAAAP,GACEP,KAAKC,0BAA4BD,KAAKC,2BACtCD,KAAKC,8BAA2Bc,CACjC,CAED,gBAAAF,CAAiBG,GAEf,OADYhB,KAAKiB,YACNC,WAAWlB,KAAKmB,WAAWC,QAAQJ,EAC/C,EA1DMnB,EAAAwB,OAAS,CACdC,MAAOC,OACPP,UAAWQ,QAEN3B,EAAA4B,QAAU,CAAC,eCKPC,EAMX,WAAAC,CAAYL,SACVtB,KAAK4B,WAAa,IAAIC,IACtB7B,KAAKiB,YAAcK,EAAML,YACzBjB,KAAKmB,UAAYG,EAAMQ,OAAOX,UAC9BnB,KAAK+B,eAAiBT,EAAMQ,OAAOE,YAEnCC,EAAAjC,KAAKiB,aAAYC,aAAAe,EAAAf,WAAe,CAAA,GAChClB,KAAKiB,YAAYC,WAAWlB,KAAKmB,WAAanB,KAE1CA,KAAK+B,gBACP/B,KAAKiB,YAAYiB,SACf,eAAelC,KAAKmB,YACpBnB,KAAK+B,eAGV,CAED,QAAAG,CAASC,EAAcnB,EAAcgB,GAEnC,GADAA,IAAAA,EAAehC,KAAK+B,gBAChB/B,KAAK4B,WAAWQ,IAAID,GACtB,MAAM,IAAIE,MAAM,cAAcF,6BAIhC,GAFAnC,KAAK4B,WAAWU,IAAIH,EAAMnB,GAEtBgB,EAAY,CACd,MAAMO,EAAiB,eAAevC,KAAKmB,aC5ChBqB,ED4C8CL,EC3CtEK,EAAIC,QAAQ,kBAAmB,SAASC,gBD4C3C1C,KAAKiB,YAAYiB,SAASK,EAAgBP,EAC3C,CC9C2B,IAACQ,CD+C9B,CAED,OAAApB,CAAQe,GACN,MAAMnB,EAAYhB,KAAK4B,WAAWe,IAAIR,GACtC,IAAKnB,EACH,MAAM,IAAIqB,MAAM,sBAAsBF,KAExC,OAAOnB,CACR"}