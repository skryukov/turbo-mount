import{Controller as t,Application as o}from"@hotwired/stimulus";class n extends t{constructor(){super(...arguments),this.skipPropsChangeCallback=!1}connect(){this._umountComponentCallback||(this._umountComponentCallback=this.mountComponent(this.mountElement,this.resolvedComponent,this.componentProps))}disconnect(){this.umountComponent()}propsValueChanged(){this.skipPropsChangeCallback?this.skipPropsChangeCallback=!1:(this.umountComponent(),this._umountComponentCallback||(this._umountComponentCallback=this.mountComponent(this.mountElement,this.resolvedComponent,this.componentProps)))}get componentProps(){return this.propsValue}get mountElement(){return this.hasMountTarget?this.mountTarget:this.element}get resolvedComponent(){return this.resolveMounted(this.componentValue).component}get resolvedPlugin(){return this.resolveMounted(this.componentValue).plugin}umountComponent(){this._umountComponentCallback?.(),this._umountComponentCallback=void 0}mountComponent(t,o,n){return this.resolvedPlugin.mountComponent({el:t,Component:o,props:n})}resolveMounted(t){return this.application.turboMount.resolve(t)}setComponentProps(t){this.skipPropsChangeCallback=!0,this.propsValue=t}}n.values={props:Object,component:String},n.targets=["mount"];const e=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/_/g,"-").replace(/\//g,"--").toLowerCase(),r=t=>t.replace(/\.\w*$/,"").replace(/^[./]*components\//,""),s=t=>{if(t.endsWith("/index")){return t.replace(/\/index$/,"")||null}return null};class i{constructor(t={}){this.components=new Map,this.application=this.findOrStartApplication(t.application),this.application.turboMount=this,this.application.register("turbo-mount",n),document.addEventListener("turbo:before-morph-element",(t=>{const o=t,{target:n,detail:e}=o;n.getAttribute("data-controller")?.includes("turbo-mount")&&(n.setAttribute("data-turbo-mount-props-value",e.newElement.getAttribute("data-turbo-mount-props-value")||"{}"),t.preventDefault())}))}register(t,o,r,s){if(s||(s=n),this.components.has(o))throw new Error(`Component '${o}' is already registered.`);if(this.components.set(o,{component:r,plugin:t}),s){const t=`turbo-mount-${e(o)}`;this.application.register(t,s)}}resolve(t){const o=this.components.get(t);if(!o)throw new Error(`Unknown component: ${t}`);return o}findOrStartApplication(t){let n=t||window.Stimulus;return n||(n=o.start(),window.Stimulus=n),n}}function u(t){return(o,n,e,r)=>{o.register(t,n,e,r)}}const l=({plugin:t,turboMount:o,components:n,controllers:e=[]})=>{const i=new Set,u=[];for(const{filename:l,module:a}of n){const n=r(l),m=a.default??a;p({plugin:t,turboMount:o,availableControllers:e,componentName:n,component:m}),i.add(n);const c=s(n);c&&u.push({name:c,module:a})}for(const{name:n,module:r}of u)if(!i.has(n)){const s=r.default??r;p({plugin:t,turboMount:o,availableControllers:e,componentName:n,component:s}),i.add(n)}},p=({plugin:t,turboMount:o,availableControllers:n,componentName:r,component:s})=>{const i=(t=>{const o=e(t);return[`turbo-mount--${o}`,`turbo-mount-${o}`]})(r),u=n.find((({identifier:t})=>i.includes(t)));u?o.register(t,r,s,u.controllerConstructor):o.register(t,r,s)};export{i as TurboMount,n as TurboMountController,u as buildRegisterFunction,l as registerComponentsBase};
//# sourceMappingURL=turbo-mount.min.js.map
